# You can remove this file if you have cloned this repository. This file tests the project on various 
# Python versions and architectures using GitHub Actions. You probably don't need this file in your own project.

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  test:
    name: Test on Python ${{ matrix.python-version }} (${{ matrix.architecture }})
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        python-version: ['3.9', '3.10', '3.11']
        architecture: ['x64', 'arm64']
        include:
          - architecture: x64
            os: ubuntu-latest
          - architecture: arm64
            os: ubuntu-24.04-arm
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
          architecture: ${{ matrix.architecture }}
      
      - name: Install uv
        uses: astral-sh/setup-uv@v5
      
      - name: Create virtual environment
        run: uv venv .venv
      
      - name: Install dependencies
        run: uv sync
      
      - name: Verify installation
        run: |
          source .venv/bin/activate
          python --version
          python -c "import pyspark; print(f'PySpark: {pyspark.__version__}')"
          python -c "import snowflake.snowpark.connect; print('Snowpark Connect imported successfully')"
          snowpark-submit --help
